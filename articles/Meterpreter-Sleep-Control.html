<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Git Reference Sites | Metasploit spike</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Git Reference Sites" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Learning Git" />
<meta property="og:description" content="Learning Git" />
<link rel="canonical" href="/metasploit-framework/articles/Git-Reference-Sites.html" />
<meta property="og:url" content="/metasploit-framework/articles/Git-Reference-Sites.html" />
<meta property="og:site_name" content="Metasploit spike" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-01-12T17:14:28+00:00" />
<script type="application/ld+json">
{"description":"Learning Git","headline":"Git Reference Sites","dateModified":"2012-01-12T17:14:28+00:00","datePublished":"2012-01-12T17:14:28+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/metasploit-framework/articles/Git-Reference-Sites.html"},"url":"/metasploit-framework/articles/Git-Reference-Sites.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/metasploit-framework/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/metasploit-framework/feed.xml" title="Metasploit spike" /></head>
<body><header class="site-header" role="banner">

    <div class="wrapper"><a class="site-title" rel="author" href="/metasploit-framework/">Metasploit spike</a><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
              </svg>
            </span>
          </label>
  
          <div class="trigger">
            <a class="page-link" href="/metasploit-framework/">Articles</a><a class="page-link" href="/metasploit-framework/modules/">Modules</a></div>
        </nav></div>
  </header>
  <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Meterpreter Sleep Control</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2016-07-11T20:02:05+01:00" itemprop="datePublished">Jul 11, 2016
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>There comes a time in the life of many a Meterpreter session when it needs to go quiet for a while. There are many reasons that this might be needed:</p>

<ul>
  <li>During an assessment, the blue team may have detected suspicious activity, and communications is too noisy.</li>
  <li>Long term engagements require long-term shells, but the red team isn’t awake 24-hours a day, and so keeping the communications active the whole time doesn’t make sense.</li>
  <li>Users may just want to reduce the number of shells they have to worry about at a given time and want some of them to go away for a while.</li>
</ul>

<p>For these reasons, and more, the new <code class="highlighter-rouge">sleep</code> command in Meterpreter was created. This document explains what it is and how it works.</p>

<h2 id="silent-shells">Silent shells</h2>

<p>Noise during an assessment is not necessarily a good thing. With the advent of Meterpreter’s new support and control of <a href="https://github.com/rapid7/metasploit-framework/wiki/Meterpreter-Transport-Control">multiple transports</a>, Meterpreter has the ability to change transports and therefore change the traffic pattern for communication. However, sometimes this isn’t enough and sometimes users want to be able to shut the session off temporarily.</p>

<p>The <code class="highlighter-rouge">sleep</code> command is designed to do just that: make the current Meterpreter session go to sleep for a specified period of time, and the wake up again once that time has expired.</p>

<p>During this dormant period, no socket is active, no requests are made, and no responses are given. From the perspective of Metasploit it’s as if the Meterpreter session doesn’t exist.</p>

<p>The interface to the sleep command looks like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; sleep
Usage: sleep &lt;time&gt;

  time: Number of seconds to wait (positive integer)

  This command tells Meterpreter to go to sleep for the specified
  number of seconds. Sleeping will result in the transport being
  shut down and restarted after the designated timeout.
</code></pre></div></div>

<p>As shown, <code class="highlighter-rouge">sleep</code> expects to be given a single postive integer value that represents the number of seconds that Meterpreter should be silent for. When run, the session will close, and then callback after the elapsed period of time. Given that Meterpreter lives in memory, this lack of communication will make it extremely difficult to track.</p>

<p>The following shows a sample run where Meterpreter is put to sleep for 20 seconds, after which the session reconnects while the handler is still in background:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; sleep 20
[*] Telling the target instance to sleep for 20 seconds ...
[+] Target instance has gone to sleep, terminating current session.

[*] 10.1.10.35 - Meterpreter session 3 closed.  Reason: User exit
msf exploit(handler) &gt; [*] Meterpreter session 4 opened (10.1.10.40:6005 -&gt; 10.1.10.35:49315) at 2015-06-02 23:00:29 +1000

msf exploit(handler) &gt; sessions -i 4
[*] Starting interaction with 4...

meterpreter &gt; getuid
Server username: WIN-S45GUQ5KGVK\OJ
</code></pre></div></div>

<h2 id="under-the-hood">Under the hood</h2>

<p>The implementation of this command was made rather simple as a result of the work that was done to support multiple transports. To facilitate this command, all that happens is:</p>

<ul>
  <li>A transport change is invoked, but the transport that is selected as the “next” transport is the same as the currently active one.</li>
  <li>The transport is shut down and the session is closed.</li>
  <li>The timeout value is passed to a call to <code class="highlighter-rouge">sleep()</code>, forcing the main thread of execution to pause for the allotted period of time.</li>
  <li>Execution resumes, and the resumption of connectivity continues in the usual transport switching fashion, only in this case, the transport that is fired up is the one that was just shut down.</li>
</ul>

<p>In short, the <code class="highlighter-rouge">sleep</code> command is a transport switch to the current transport with a delay. Simple!</p>

  </div><a class="u-url" href="/metasploit-framework/articles/Meterpreter-Sleep-Control.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/metasploit-framework/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Metasploit spike</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Metasploit spike</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/metasploit-framework/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/metasploit-framework/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
