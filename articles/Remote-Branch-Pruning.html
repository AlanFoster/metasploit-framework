<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Git Reference Sites | Metasploit spike</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Git Reference Sites" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Learning Git" />
<meta property="og:description" content="Learning Git" />
<link rel="canonical" href="/metasploit-framework/articles/Git-Reference-Sites.html" />
<meta property="og:url" content="/metasploit-framework/articles/Git-Reference-Sites.html" />
<meta property="og:site_name" content="Metasploit spike" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-01-12T17:14:28+00:00" />
<script type="application/ld+json">
{"description":"Learning Git","headline":"Git Reference Sites","dateModified":"2012-01-12T17:14:28+00:00","datePublished":"2012-01-12T17:14:28+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/metasploit-framework/articles/Git-Reference-Sites.html"},"url":"/metasploit-framework/articles/Git-Reference-Sites.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/metasploit-framework/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/metasploit-framework/feed.xml" title="Metasploit spike" /></head>
<body><header class="site-header" role="banner">

    <div class="wrapper"><a class="site-title" rel="author" href="/metasploit-framework/">Metasploit spike</a><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
              </svg>
            </span>
          </label>
  
          <div class="trigger">
            <a class="page-link" href="/metasploit-framework/">Articles</a><a class="page-link" href="/metasploit-framework/modules/">Modules</a></div>
        </nav></div>
  </header>
  <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Remote Branch Pruning</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2012-06-29T21:35:32+01:00" itemprop="datePublished">Jun 29, 2012
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Since we have a lot of people creating and merging branches on the Metasploit GitHub repository, we need to periodically get rid of old and abandoned branches. Here’s my technique:</p>

<h1 id="back-up-the-repo">Back up the repo</h1>

<p>Clone a new metasploit-framework.git repository:</p>

<p><code class="highlighter-rouge">todb@presto:~/github/todb-r7$ git clone github_r7:rapid7/metasploit-framework.git msf-backup.git</code></p>

<p>Go there and check out every remote branch we’ve got. That way, if you screw up and delete something important, you can add it back in later from this backup clone.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>todb@presto:~/github/todb-r7$ cd msf-backup.git
`todb@presto:~/github/todb-r7/metasploit-framework$ for b in `git branch -r | grep -v "HEAD -&gt; origin" | sed 's/^  origin\///'`; do git checkout -b $b --track origin/$b; done
</code></pre></div></div>

<p>Tarball it out of the way.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>todb@presto:~/github/todb-r7$ cd ..
todb@presto:~/github$ tar zxvf msf-backup.git.tar.gz
todb@presto:~/github$ rm -rf msf-backup.git
</code></pre></div></div>

<h1 id="make-a-new-clone">Make a new clone</h1>

<p>Now, clone metasploit again. I do this because I have like 20 remotes to deal with on my “real” clone and I don’t want to have to grep through all my origin vs non-origin stuff.</p>

<p><code class="highlighter-rouge">mazikeen:./rapid7$ git clone github_r7:rapid7/metasploit-framework.git msf-prune</code></p>

<p>Now start figuring out what branches to delete.</p>

<p>First, wipe out anything that responds to prune. Usually that’s not a lot.</p>

<p><code class="highlighter-rouge">mazikeen:./msf-prune$ git prune remote origin</code></p>

<p>Next, take a look at what’s already merged and what’s not. We can drop most of the merged stuff right away.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mazikeen:./msf-prune$ git branch -r --merged 
mazikeen:./msf-prune$ git branch -r --no-merged 
</code></pre></div></div>

<p>That gives a pretty good idea of how many branches we’re talking about.</p>

<h1 id="start-deleting-old-merged-branches">Start deleting old, merged branches</h1>

<p>Here’s a one-liner, lightly modified from http://stackoverflow.com/questions/2514172/listing-each-branch-and-its-last-revisions-date-in-git#2514279 which lists all remote <strong>merged</strong> branches in date order.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mazikeen:./msf-prune$ for k in `git branch -r --merged |grep -v "HEAD -&gt;" | sed s/^..//`; do echo -e `git log -1 --pretty=format:"%Cgreen%ci %Cblue%cr%Creset" $k --`\\t"$k";done | sort
</code></pre></div></div>

<p>Count off how many you want to keep at the end, do the arithmetic, and tack on another couple pipes to catch everything that’s more than two weeks old. These are the merged branches that nobody’s likely to miss.</p>

<pre><code class="language-`">mazikeen:./msf-prune$ for k in `git branch -r --merged |grep -v "HEAD -&gt;" | sed s/^..//`; do echo -e `git log -1 --pretty=format:"%Cgreen%ci %Cblue%cr%Creset" $k --`\\t"$k";done | sort | head -45 | sed "s/^.*origin\///" &gt; /tmp/merged_to_delete.txt
</code></pre>

<p>Pull the trigger:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mazikeen:./msf-prune$ for b in `cat /tmp/merged_to_delete.txt`; do echo Deleting $b &amp;&amp; git push origin :$b; done
</code></pre></div></div>

<p>Note that we still have our tarball, so if we need to reinstate any of these branches, just need to re-push.</p>

<h1 id="repeat-for-the-unmerged-branches">Repeat for the unmerged branches</h1>

<p>Pretty much the same as above, but use <code class="highlighter-rouge">--no-merged</code> instead of <code class="highlighter-rouge">--merged</code> and allow for older unmerged branches (say, 2 months).</p>

<h1 id="tell-people-about-it">Tell people about it.</h1>

<p>Sometimes, some people may run into sync problems with these missing branches and need to <code class="highlighter-rouge">git remote prune origin</code> themselves. Alternatively, they want to look into these branches again – especially the unmerged ones. So, let people know that you just did this on the metasploit-hackers list and the Freenode IRC channel. If someone wants an old branch back, just go to your backup clone and push it back up as you would any branch: <code class="highlighter-rouge">git checkout branchname &amp;&amp; git push origin branchname</code>. No problem.</p>


  </div><a class="u-url" href="/metasploit-framework/articles/Remote-Branch-Pruning.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/metasploit-framework/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Metasploit spike</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Metasploit spike</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/metasploit-framework/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/metasploit-framework/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
