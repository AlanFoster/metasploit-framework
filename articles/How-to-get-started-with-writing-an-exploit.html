<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Git Reference Sites | Metasploit spike</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Git Reference Sites" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Learning Git" />
<meta property="og:description" content="Learning Git" />
<link rel="canonical" href="/metasploit-framework/articles/Git-Reference-Sites.html" />
<meta property="og:url" content="/metasploit-framework/articles/Git-Reference-Sites.html" />
<meta property="og:site_name" content="Metasploit spike" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-01-12T17:14:28+00:00" />
<script type="application/ld+json">
{"description":"Learning Git","headline":"Git Reference Sites","dateModified":"2012-01-12T17:14:28+00:00","datePublished":"2012-01-12T17:14:28+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/metasploit-framework/articles/Git-Reference-Sites.html"},"url":"/metasploit-framework/articles/Git-Reference-Sites.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/metasploit-framework/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/metasploit-framework/feed.xml" title="Metasploit spike" /></head>
<body><header class="site-header" role="banner">

    <div class="wrapper"><a class="site-title" rel="author" href="/metasploit-framework/">Metasploit spike</a><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
              </svg>
            </span>
          </label>
  
          <div class="trigger">
            <a class="page-link" href="/metasploit-framework/">Articles</a><a class="page-link" href="/metasploit-framework/modules/">Modules</a></div>
        </nav></div>
  </header>
  <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">How to get started with writing an exploit</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-11-29T11:30:45+00:00" itemprop="datePublished">Nov 29, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>The real kung-fu behind exploit development isn’t actually about which language you choose to build it, it’s about your precise understanding of how an input is processed by the application you’re debugging, and how to gain control by manipulating it. That’s right, the keyword is “debugging.” Your binjitsu (reverse-engineering) is where the real kung-fu is. However, if your goal isn’t just about popping a calculator, but actually want to weaponize, to maintain, and to provide use in the practical world, you need a development framework. And this is where Metasploit comes in. It’s a framework that’s free and open-source, actively contributed by researchers around the world. So when you write a Metasploit exploit, you don’t have to worry about any <a href="http://en.wikipedia.org/wiki/Dependency_hell">dependency issues</a>, or having the wrong version, or not having enough payloads for different pentesting scenarios to choose from, etc. The idea is all you need to do is focus on building that exploit, and nothing more.</p>

<h3 id="plan-your-module">Plan your module</h3>

<p>Unlike writing a proof-of-concept, when you write a Metasploit module you need to think about how users might use it in the real world. Stealth is usually an important element to think about. Can your exploit achieve code execution without dropping a file? Can the input look more random so it’s more difficult to detect? How about obfuscation? Is it generating unnecessary traffic? Can it be more stable without crashing the system so much, etc, etc.</p>

<p>Also, try to be precise about exploitable requirements. Usually, a bug is specific to a range of versions, or even builds. If you can’t automatically check that, you need to at least mention it in the description somewhere. Some of your exploit’s techniques might also be application-specific. For example, you can take advantage of a specific behavior in the application to generate heap allocations the way you want, but maybe it’s more noisy in the newer version so that gives you some stability issues. Does it need a 3rd-party component to work that may not even be installed by everyone? Even if it is, is the component revised often that could make your exploit less reliable?</p>

<p>Know that in the real world, your exploit can break or fail in a lot of different ways. You should try to find out and fix it during the development and testing phase before learning the hard way.</p>

<h3 id="ranking">Ranking</h3>

<p>As you can see, reliability is important to Metasploit, and we try to be more friendly about this for the users. I know what you’re thinking: “Well, if they’re using the exploit they should understand how it works, so they know what they’re getting themselves into.” In the perfect world, yes. Knowing how a vulnerability works or how an exploit works will only benefit the user, but you see, we don’t live in the perfect world. If you’re in the middle of a penetration test, it’s very unlikely to always find the time to recreate the vulnerable environment, strip the exploit to the most basic form to debug what’s going on, and then do testing. Chances are you have a tight schedule to break into a large network, so you need to use your time carefully. Because of this, it’s important to at least have a good description and good references for the module. And of course, a ranking system that can be trusted.</p>

<p>The Metasploit Framework has seven different rankings to indicate how reliable an exploit is. See [[Exploit Ranking]] for more details.</p>

<h3 id="template">Template</h3>

<p>If you have read this far, we think you are pretty impressive because it’s a lot to digest. You are probably wondering why we haven’t had a single line of code to share in the write-up. Well, as you recall, exploit development is mostly about your reversing skills. If you have all that, we shouldn’t be telling you how to write an exploit. What we’ve done so far is hopefully get your mindset dialed-in correctly about what it means to become a Metasploit exploit developer for the security community, the rest is more about how to use our mixins to build that exploit. Well, there are A LOT of mixins so it’s impossible to go over all of them in a single page, so you must either read the <a href="https://dev.metasploit.com/api/">API documentation</a>, existing <a href="https://github.com/rapid7/metasploit-framework/tree/master/modules/exploits">code examples</a>, or look for more wiki pages we’ve written to cover specific mixins.</p>

<p>For example, if you’re looking for a writeup about how to interact with an HTTP server, you might be interested in: <a href="https://github.com/rapid7/metasploit-framework/wiki/How-to-Send-an-HTTP-Request-Using-HTTPClient">How to send an HTTP Request Using HTTPClient</a>. If you’re interested in browser exploit writing, definitely check out: <a href="https://github.com/rapid7/metasploit-framework/wiki/How-to-write-a-browser-exploit-using-BrowserExploitServer">How to write a browser exploit using BrowserExploitServer</a>, etc.</p>

<p>But of course, to begin you most likely need a template to work with, and here it is. We’ll also explain how to fill out the required fields:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">##</span>
<span class="c1"># This module requires Metasploit: http://metasploit.com/download</span>
<span class="c1"># Current source: https://github.com/rapid7/metasploit-framework</span>
<span class="c1">##</span>

<span class="nb">require</span> <span class="s1">'msf/core'</span>

<span class="k">class</span> <span class="nc">MetasploitModule</span> <span class="o">&lt;</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Exploit</span><span class="o">::</span><span class="no">Remote</span>
  <span class="no">Rank</span> <span class="o">=</span> <span class="no">NormalRanking</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">info</span><span class="o">=</span><span class="p">{})</span>
    <span class="k">super</span><span class="p">(</span><span class="n">update_info</span><span class="p">(</span><span class="n">info</span><span class="p">,</span>
      <span class="s1">'Name'</span>           <span class="o">=&gt;</span> <span class="s2">"[Vendor] [Software] [Root Cause] [Vulnerability type]"</span><span class="p">,</span>
      <span class="s1">'Description'</span>    <span class="o">=&gt;</span> <span class="sx">%q{
        Say something that the user might need to know
      }</span><span class="p">,</span>
      <span class="s1">'License'</span>        <span class="o">=&gt;</span> <span class="no">MSF_LICENSE</span><span class="p">,</span>
      <span class="s1">'Author'</span>         <span class="o">=&gt;</span> <span class="p">[</span> <span class="s1">'Name'</span> <span class="p">],</span>
      <span class="s1">'References'</span>     <span class="o">=&gt;</span>
        <span class="p">[</span>
          <span class="p">[</span> <span class="s1">'URL'</span><span class="p">,</span> <span class="s1">''</span> <span class="p">]</span>
        <span class="p">],</span>
      <span class="s1">'Platform'</span>       <span class="o">=&gt;</span> <span class="s1">'win'</span><span class="p">,</span>
      <span class="s1">'Targets'</span>        <span class="o">=&gt;</span>
        <span class="p">[</span>
          <span class="p">[</span> <span class="s1">'System or software version'</span><span class="p">,</span>
            <span class="p">{</span>
              <span class="s1">'Ret'</span> <span class="o">=&gt;</span> <span class="mh">0x41414141</span> <span class="c1"># This will be available in `target.ret`</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">],</span>
      <span class="s1">'Payload'</span>        <span class="o">=&gt;</span>
        <span class="p">{</span>
          <span class="s1">'BadChars'</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="se">\x00</span><span class="s2">"</span>
        <span class="p">},</span>
      <span class="s1">'Privileged'</span>     <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span>
      <span class="s1">'DisclosureDate'</span> <span class="o">=&gt;</span> <span class="s2">""</span><span class="p">,</span>
      <span class="s1">'DefaultTarget'</span>  <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">))</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">check</span>
    <span class="c1"># For the check command</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">exploit</span>
    <span class="c1"># Main function</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div></div>

<p>The <strong>Name</strong> field should begin with the name of the vendor, followed by the software. Ideally the “Root Cause” field means which component or function the bug is found. And finally, the type of vulnerability the module is exploiting.</p>

<p>The <strong>Description</strong> field should explain what the module does, things to watch out for, specific requirements, the more the better. The goal is to let the user understand what he’s using without the need to actually read the module’s source and figure things out. And trust me, most of them don’t.</p>

<p>The <strong>Author</strong> field is where you put your name. The format should be “Name “. If you want to have your Twitter handle there, leave it as a comment, for example: “Name # handle”</p>

<p>The <strong>References</strong> field is an array of <a href="https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/module/reference.rb">references</a> related to the vulnerability or the exploit. For example: an advisory, a blog post, etc. Make sure you use known reference identifiers – see [[Metasploit module reference identifiers]] for a list.</p>

<p>The <strong>Platform</strong> field indicates what platforms are supported, for example: win, linux, osx, unix, bsd.</p>

<p>The <strong>Targets</strong> field is an array of systems, applications, setups, or specific versions your exploit is targeting. The second element or each target array is where you store specific metadata about that target, for example: a specific offset, a gadget, a ret address, etc. When a target is selected by the user, the metadata is loaded and tracked by a “target index”, and can be retrieved by using the <code class="highlighter-rouge">target</code> method.</p>

<p>The <strong>Payloads</strong> field specifies how the payload should be encoded and generated. You can specify: <code class="highlighter-rouge">Space</code>, <code class="highlighter-rouge">SaveRegisters</code>, <code class="highlighter-rouge">Prepend</code>, <code class="highlighter-rouge">PrependEncoder</code>, <code class="highlighter-rouge">BadChars</code>, <code class="highlighter-rouge">Append</code>, <code class="highlighter-rouge">AppendEncoder</code>, <code class="highlighter-rouge">MaxNops</code>, <code class="highlighter-rouge">MinNops</code>, <code class="highlighter-rouge">Encoder</code>, <code class="highlighter-rouge">Nop</code>, <code class="highlighter-rouge">EncoderType</code>, <code class="highlighter-rouge">EncoderOptions</code>, <code class="highlighter-rouge">ExtendedOptions</code>, <code class="highlighter-rouge">EncoderDontFallThrough</code>.</p>

<p>The <strong>DisclosureDate</strong> is about when the vulnerability was disclosed in public, in the format of: “M D Y”. For example: “Apr 04 2014”</p>

<p>Your exploit should also have a <code class="highlighter-rouge">check</code> method to support the check command, but this is optional in case it’s not possible.</p>

<p>And finally, the <code class="highlighter-rouge">exploit</code> method is like your main method. Start writing your code there.</p>

<p>An example exploit module is also available: <a href="https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/example.rb">example.rb</a></p>

<h3 id="basic-git-commands">Basic git commands</h3>

<p>Metasploit no longer uses svn for source code management, instead we use git, so knowing some tricks with git go a long way. We’re not here to lecture you about how awesome git is, we know it has a learning curve and it’s not surprising to find new users making mistakes. Every once a while, your git “rage” will kick in, and we understand. However, it’s important for you to take advantage of branching.</p>

<p>Every time you make a module, or make some changes to existing code, you should not do so on the default master branch. Why? Because when you do a <code class="highlighter-rouge">msfupdate</code>, which is Metasploit’s utility for updating your repository, it will do a git reset before merging the changes, and all your code go bye-bye.</p>

<p>Another mistake people tend to do is have all the changes on master before submitting a pull request. This is a bad idea, because most likely you’re submitting other crap you don’t intend to change, and/or you’re probably asking us to merge other unnecessary commit history when there only needs to be one commit. Thanks for contributing your module to the community, but no thanks to your crazy commit history.</p>

<p>So as a habit, when you want to make something new, or change something, begin with a new branch that’s up to date to master. First off, make sure you’re on master. If you do a <code class="highlighter-rouge">git status</code> it will tell you what branch you’re currently on:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git status
# On branch upstream-master
nothing to commit, working directory clean
</code></pre></div></div>

<p>Ok, now do a <code class="highlighter-rouge">git pull</code> to download the latest changes from Metasploit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git pull
Already up-to-date.
</code></pre></div></div>

<p>At this point, you’re ready to start a new branch. In this case, we’ll name our new branch “my_awesome_branch”:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git checkout -b my_awesome_branch
Switched to a new branch 'my_awesome_branch'
</code></pre></div></div>

<p>And then you can go ahead and add that module. Make sure it’s in the appropriate path:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git add [module path]
</code></pre></div></div>

<p>When you decide to save the changes, commit (if there’s only one module, you can do <code class="highlighter-rouge">git commit -a</code> too so you don’t have to type the module path. Note <code class="highlighter-rouge">-a</code> really means EVERYTHING):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git commit [module path]
</code></pre></div></div>

<p>When you’re done, push your changes, which will upload your code to your remote branch “my_awesome_branch”. You must push your changes in order to submit the pull request, or share it with others on the Internet.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git push origin my_awesome_branch
</code></pre></div></div>

<h3 id="references">References</h3>

<p>https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/exploit.rb</p>

  </div><a class="u-url" href="/metasploit-framework/articles/How-to-get-started-with-writing-an-exploit.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/metasploit-framework/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Metasploit spike</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Metasploit spike</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/metasploit-framework/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/metasploit-framework/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
