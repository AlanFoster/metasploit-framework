<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Git Reference Sites | Metasploit spike</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Git Reference Sites" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Learning Git" />
<meta property="og:description" content="Learning Git" />
<link rel="canonical" href="/metasploit-framework/articles/Git-Reference-Sites.html" />
<meta property="og:url" content="/metasploit-framework/articles/Git-Reference-Sites.html" />
<meta property="og:site_name" content="Metasploit spike" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-01-12T17:14:28+00:00" />
<script type="application/ld+json">
{"description":"Learning Git","headline":"Git Reference Sites","dateModified":"2012-01-12T17:14:28+00:00","datePublished":"2012-01-12T17:14:28+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/metasploit-framework/articles/Git-Reference-Sites.html"},"url":"/metasploit-framework/articles/Git-Reference-Sites.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/metasploit-framework/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/metasploit-framework/feed.xml" title="Metasploit spike" /></head>
<body><header class="site-header" role="banner">

    <div class="wrapper"><a class="site-title" rel="author" href="/metasploit-framework/">Metasploit spike</a><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
              </svg>
            </span>
          </label>
  
          <div class="trigger">
            <a class="page-link" href="/metasploit-framework/">Articles</a><a class="page-link" href="/metasploit-framework/modules/">Modules</a></div>
        </nav></div>
  </header>
  <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <h1>MS09-004 Microsoft SQL Server sp_replwritetovarbin Memory Corruption via SQL Injection</h1>

<section><strong>name</strong>
       
      <div>MS09-004 Microsoft SQL Server sp_replwritetovarbin Memory Corruption via SQL Injection</div>       
    <strong>fullname</strong>
       
      <div>exploit/windows/mssql/ms09_004_sp_replwritetovarbin_sqli</div>       
    <strong>aliases</strong>
       
      <div></div>       
    <strong>rank</strong>
       
      <div>600</div>       
    <strong>disclosure_date</strong>
       
      <div>2008-12-09</div>       
    <strong>type</strong>
       
      <div>exploit</div>       
    <strong>author</strong>
    
      <ul><li>jduck <jduck@metasploit.com></li>
        <li>Rodrigo Marcos</li>
        
      </ul>
    <strong>description</strong>
    
      <pre>A heap-based buffer overflow can occur when calling the undocumented
        "sp_replwritetovarbin" extended stored procedure. This vulnerability affects
        all versions of Microsoft SQL Server 2000 and 2005, Windows Internal Database,
        and Microsoft Desktop Engine (MSDE) without the updates supplied in MS09-004.
        Microsoft patched this vulnerability in SP3 for 2005 without any public
        mention.

        This exploit smashes several pointers, as shown below.

        1. pointer to a 32-bit value that is set to 0
        2. pointer to a 32-bit value that is set to a length influenced by the buffer
          length.
        3. pointer to a 32-bit value that is used as a vtable pointer. In MSSQL 2000,
          this value is referenced with a displacement of 0x38. For MSSQL 2005, the
          displacement is 0x10. The address of our buffer is conveniently stored in
          ecx when this instruction is executed.
        4. On MSSQL 2005, an additional vtable ptr is smashed, which is referenced with
          a displacement of 4. This pointer is not used by this exploit.

        This particular exploit replaces the previous dual-method exploit. It uses
        a technique where the value contained in ecx becomes the stack. From there,
        return oriented programming is used to normalize the execution state and
        finally execute the payload via a "jmp esp". All addresses used were found
        within the sqlservr.exe memory space, yielding very reliable code execution
        using only a single query.

        NOTE: The MSSQL server service does not automatically restart by default. That
        said, some exceptions are caught and will not result in terminating the process.
        If the exploit crashes the service prior to hijacking the stack, it won't die.
        Otherwise, it's a goner.</pre>
    <strong>references</strong>
    
      <ul><li>OSVDB-50589</li>
        <li>CVE-2008-5416</li>
        <li>BID-32710</li>
        <li>MSB-MS09-004</li>
        <li>EDB-7501</li>
        <li>URL-http://www.secforce.co.uk/blog/2011/01/exploiting-ms09-004-via-sql-injection/</li>
        
      </ul>
    <strong>platform</strong>
       
      <div>Windows</div>       
    <strong>arch</strong>
       
      <div></div>       
    <strong>rport</strong>
       
      <div>80</div>       
    <strong>autofilter_ports</strong>
    
      <ul><li>80</li>
        <li>8080</li>
        <li>443</li>
        <li>8000</li>
        <li>8888</li>
        <li>8880</li>
        <li>8008</li>
        <li>3000</li>
        <li>8443</li>
        
      </ul>
    <strong>autofilter_services</strong>
    
      <ul><li>http</li>
        <li>https</li>
        
      </ul>
    <strong>targets</strong>
       
      <div>AutomaticMSSQL 2000 / MSDE SP0 (8.00.194)MSSQL 2000 / MSDE SP1 (8.00.384)MSSQL 2000 / MSDE SP2 (8.00.534)MSSQL 2000 / MSDE SP3 (8.00.760)MSSQL 2000 / MSDE SP4 (8.00.2039)MSSQL 2005 SP0 (9.00.1399.06)MSSQL 2005 SP1 (9.00.2047.00)MSSQL 2005 SP2 (9.00.3042.00)CRASHER</div>       
    <strong>mod_time</strong>
       
      <div>2017-09-13 22:03:34 +0000</div>       
    <strong>path</strong>
       
      <div>/modules/exploits/windows/mssql/ms09_004_sp_replwritetovarbin_sqli.rb</div>       
    <strong>is_install_path</strong>
       
      <div>true</div>       
    <strong>ref_name</strong>
       
      <div>windows/mssql/ms09_004_sp_replwritetovarbin_sqli</div>       
    <strong>check</strong>
       
      <div>true</div>       
    <strong>post_auth</strong>
       
      <div>false</div>       
    <strong>default_credential</strong>
       
      <div>false</div>       
    <strong>notes</strong>
       
      <div>{}</div>       
    <strong>needs_cleanup</strong>
       
      <div></div>       
    </section>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/metasploit-framework/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Metasploit spike</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Metasploit spike</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/metasploit-framework/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/metasploit-framework/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
