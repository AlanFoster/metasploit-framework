I"Ã<p>Sometimes, modules contributed to Metasploit don‚Äôt quite cross the finish line. This can be for a variety of reasons. Most often, it is because the module submission was a ‚Äúdrive-by‚Äù ‚Äì the original author is not interested (or not able) to implement and test needed changes in order to make the module production worthy.</p>

<p>Luckily, git makes it easy to be a pack rat for these unfinished modules. We have a separate branch for these unstable modules, imaginatively named, <a href="https://github.com/rapid7/metasploit-framework/tree/unstable">Unstable</a>.</p>

<h2 id="landing-to-unstable">Landing to Unstable</h2>

<p>Unstable modules have their own special directory structure ‚Äì they should <strong>not</strong> hit the regular <code class="highlighter-rouge">modules/</code> subdirectory, since we don‚Äôt want to conflict with existing or future modules. We also want to make it easy to spot which modules are unstable. So, new modules should get landed there with the following procedure.</p>

<ol>
  <li>First, get unstable up to date with upstream/master: <code class="highlighter-rouge">git checkout unstable; git merge upstream/master; push upstream</code></li>
  <li>Create a local branch off of the PR: <code class="highlighter-rouge">git checkout -b temp-pr1234 --track upstream/pr/1234</code></li>
  <li>Create a local branch off of unstable: <code class="highlighter-rouge">git checkout -b unstable-pr1234-modulename --track upstream/unstable</code></li>
  <li>Find the module paths: <code class="highlighter-rouge">git diff upstream/master...upstream/pr/1234 --name-only</code></li>
  <li>Git checkout the module(s) in question: <code class="highlighter-rouge">git checkout temp-pr1234 modules/exploits/path/to/module.rb</code></li>
  <li>Move the files to the appropriate directory: <code class="highlighter-rouge">git mv modules/exploits/path/to/module.rb unstable-modules/exploits/incomplete</code></li>
  <li>Commit the result: <code class="highlighter-rouge">git commit</code></li>
  <li>Send a pull request targeting the unstable branch, <strong>not</strong> the master branch: https://github.com/YOU/metasploit-framework/compare/rapid7:unstable‚Ä¶unstable-pr1234-modulename?expand=1 . Be sure to mention the original pull request number in the description so the PR will be updated accordingly.</li>
</ol>

<p>This assumes you‚Äôre set up for development a la http://r-7.co/MSF-DEV with Rapid7‚Äôs branch being the ‚Äúupstream‚Äù repo.</p>

<h2 id="example">Example</h2>

<p>For an example of this procedure, see <a href="https://github.com/rapid7/metasploit-framework/pull/2801">PR #2801</a>.</p>

<h2 id="unstable-libraries">Unstable Libraries</h2>

<p>If someone has library changes that cannot be merged to master, we cannot hang on to them in unstable. There is no sensible way to maintain that kind of branch over any reasonable time period, since conflicts will surely abound soon. Unstable scripts and plugins are okay, though.</p>

<h2 id="rescuing-unstable-modules">Rescuing unstable modules</h2>

<p>If you‚Äôd like to rescue an unstable module, great! Just note that it‚Äôs an unstable rescue in the pull request, and the original PR number (if you can find it), when you pull it back out. You can do a similiar <code class="highlighter-rouge">git checkout</code> to grab the file and then <code class="highlighter-rouge">git mv</code> it to the right spot again.</p>

<h2 id="safety">Safety</h2>

<p>This is not <code class="highlighter-rouge">unstable</code> in the Debian sense ‚Äì they‚Äôre not latest versions, they get no fixes unless someone adopts them, and they may end up crashing out all of framework when loaded. No guarantees are made, ever, despite things like <code class="highlighter-rouge">ExploitRanking.</code></p>
:ET