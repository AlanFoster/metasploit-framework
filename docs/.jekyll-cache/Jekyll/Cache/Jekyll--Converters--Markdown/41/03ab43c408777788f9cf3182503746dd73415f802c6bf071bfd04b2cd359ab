I"i2<p><sup><em>The shortlink to this wiki page is https://r-7.co/MSF-DEV</em></sup></p>

<p>This is a guide for setting up a developer environment to contribute modules, documentation, and fixes to the Metasploit Framework. If you just want to use Metasploit for legal, authorized hacking, we recommend instead you:</p>

<ul>
  <li>Install the <a href="https://github.com/rapid7/metasploit-framework/wiki/Nightly-Installers">open-source Omnibus installer</a>, or</li>
  <li>Use the pre-installed Metasploit on <a href="https://docs.kali.org/general-use/starting-metasploit-framework-in-kali">Kali Linux</a> or <a href="https://docs.parrotsec.org/doku.php/metasploit-framework#start-metasploit">Parrot Linux</a>.</li>
</ul>

<p>If you want to contribute to Metasploit, start by reading our <a href="https://github.com/rapid7/metasploit-framework/blob/master/CONTRIBUTING.md">CONTRIBUTING.md</a>, then follow the rest of this guide.</p>

<h2 id="assumptions">Assumptions</h2>

<ul>
  <li>You have installed an apt-based Linux environment, such as <a href="https://www.ubuntu.com/download/desktop">Ubuntu</a> or <a href="https://www.kali.org/downloads/">Kali</a>.</li>
  <li>You have created a GitHub account and associated an <a href="https://help.github.com/articles/generating-ssh-keys/">ssh key</a> with it.</li>
  <li>You have familiarity with Git and Github, or have completed the <a href="https://help.github.com/articles/set-up-git/">Github bootcamp</a>.</li>
  <li>For optional database and REST API functionality, you will need regular user account that is not <code class="highlighter-rouge">root</code>.</li>
</ul>

<h2 id="install-dependencies">Install dependencies</h2>

<ol>
  <li>Open a terminal on your Linux host and set up Git, build tools, and Ruby dependencies:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> git autoconf build-essential libpcap-dev libpq-dev zlib1g-dev libsqlite3-dev
</code></pre></div></div>

<h2 id="set-up-your-local-copy-of-the-repository">Set up your local copy of the repository</h2>

<p>You will need to use Github to create a fork for your contributions and receive the latest updates from our repository.</p>

<ol>
  <li>
    <p>Login to Github and click the “Fork” button in the top-right corner of the <a href="https://github.com/rapid7/metasploit-framework/">metasploit-framework</a> repository.</p>
  </li>
  <li>
    <p>Create a <code class="highlighter-rouge">git</code> directory in your home folder and clone your fork to your local machine:</p>
  </li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">GITHUB_USERNAME</span><span class="o">=</span>YOUR_USERNAME_FOR_GITHUB
<span class="nb">export </span><span class="nv">GITHUB_EMAIL</span><span class="o">=</span>YOUR_EMAIL_ADDRESS_FOR_GITHUB
<span class="nb">mkdir</span> <span class="nt">-p</span> ~/git
<span class="nb">cd</span> ~/git
git clone git@github.com:<span class="nv">$GITHUB_USERNAME</span>/metasploit-framework
<span class="nb">cd</span> ~/git/metasploit-framework
</code></pre></div></div>

<ol>
  <li>
    <p>If you encounter a “permission denied” error on the above command, research the error message.  If there isn’t an explicit reason given, confirm that your <a href="https://help.github.com/articles/adding-a-new-ssh-key-to-your-github-account/">Github SSH key is configured correctly</a>.</p>
  </li>
  <li>
    <p>To receive updates, you will create an <code class="highlighter-rouge">upstream-master</code> branch to track the Rapid7 remote repository, alongside your <code class="highlighter-rouge">master</code> branch which will point to your personal repository’s fork:</p>
  </li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git remote add upstream git@github.com:rapid7/metasploit-framework.git
git fetch upstream
git checkout <span class="nt">-b</span> upstream-master <span class="nt">--track</span> upstream/master
</code></pre></div></div>

<ol>
  <li>Configure your Github username, email address, and username.  Ensure your <code class="highlighter-rouge">user.email</code> matches the email address you registered with your Github account.</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config <span class="nt">--global</span> user.name <span class="s2">"</span><span class="nv">$GITHUB_USERNAME</span><span class="s2">"</span>
git config <span class="nt">--global</span> user.email <span class="s2">"</span><span class="nv">$GITHUB_EMAIL</span><span class="s2">"</span>
git config <span class="nt">--global</span> github.user <span class="s2">"</span><span class="nv">$GITHUB_USERNAME</span><span class="s2">"</span>
</code></pre></div></div>

<ol>
  <li>Set up <a href="https://www.oreilly.com/library/view/metasploit-revealed-secrets/9781788624596/91660ab9-a260-4de8-a4ea-c1af64eafbec.xhtml">msftidy</a> to run before each <code class="highlighter-rouge">git commit</code> and after each <code class="highlighter-rouge">git merge</code> to quickly identify potential issues with your contributions:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/git/metasploit-framework
<span class="nb">ln</span> <span class="nt">-sf</span> ../../tools/dev/pre-commit-hook.rb .git/hooks/pre-commit
<span class="nb">ln</span> <span class="nt">-sf</span> ../../tools/dev/pre-commit-hook.rb .git/hooks/post-merge
</code></pre></div></div>

<h2 id="install-ruby">Install Ruby</h2>

<p>Linux distributions do not ship with the latest Ruby, nor are package managers routinely updated.  Additionally, if you are working with multiple Ruby projects, each one has dependencies and Ruby versions which can start to conflict.  For these reasons, it is advisable  to use a Ruby manager.</p>

<p>You could just install Ruby directly (eg. <code class="highlighter-rouge">sudo apt install ruby-dev</code>), but you may likely end up with the incorrect version and no way to update.  Instead, consider using one of the many different <a href="https://www.ruby-lang.org/en/documentation/installation/#managers">Ruby environment managers</a> available.  The Metasploit team prefers <a href="https://github.com/rbenv/rbenv#basic-github-checkout">rbenv</a> and <a href="https://github.com/rvm/ubuntu_rvm#install">rvm</a>.</p>

<p>Regardless of your choice, you’ll want to make sure that, when inside the <code class="highlighter-rouge">~/git/metasploit-framework</code> directory, you are running the correct version of Ruby:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd ~/git/metasploit-framework
$ cat .ruby-version 
2.5.3
$ ruby -v
ruby 2.5.3p105 (2018-10-18 revision 65156) [x86_64-linux-gnu]
</code></pre></div></div>

<p>Note: the Ruby version is likely to change over time, so don’t rely on the output in the above example.  Instead, confirm your <code class="highlighter-rouge">ruby -v</code> output with the version number listed in the <code class="highlighter-rouge">.ruby-version</code> file.</p>

<p>If the two versions don’t match, restart your terminal. If that does not work, consult the troubleshooting documentation for your Ruby environment manager.  Unfortunately, troubleshooting the Ruby environment is beyond the scope of this document, but feel free to reach out for community support using the links at the bottom of this document.</p>

<h2 id="install-gems">Install Gems</h2>

<ol>
  <li>Before you run Metasploit, you will need to update the gems (Ruby libraries) that Metasploit depends on:</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/git/metasploit-framework/
gem install bundler
bundle install
</code></pre></div></div>

<ol>
  <li>If you encounter an error with the above command, refer to the <code class="highlighter-rouge">bundle</code> output and search for the error message along with the name of the gem that failed. Likely, you’ll need to <code class="highlighter-rouge">apt get install</code> a dependency that is required by that particular gem.  If it was something else, open a <a href="https://github.com/rapid7/metasploit-framework/issues/new">new issue</a> to let us know what happened.</li>
</ol>

<p>Congratulations! You have now set up a development environment and the latest version of Metasploit.</p>

<h2 id="optional-set-up-the-rest-api-and-postgresql-database">Optional: Set up the REST API and PostgreSQL database</h2>

<details><summary>The following optional section describes how to manually install PostgreSQL and set up the Metasploit database.  Alternatively, use our Omnibus installer which handles this more reliably.  Click to expand.</summary>

1. Confirm that the PostgreSQL server and client are installed:

```bash
sudo apt update &amp;&amp; sudo apt-get install -y postgresql postgresql-client
sudo service postgresql start &amp;&amp; sudo update-rc.d postgresql enable
```

2. Ensure that you are not running as the root user.

3. Initialize the Metasploit database:

```bash
cd ~/git/metasploit-framework
./msfdb init
```

4. If you receive an error about a component not being installed, confirm that the binaries shown are in your path using the [which] and [find] commands, then modifying your [$PATH] environment variable.  If it was something else, open a [new issue] to let us know what happened.

5. If the `msfdb init` command succeeds, then confirm that the database is accessible to Metasploit:

```bash
$ ./msfconsole -qx "db_status; exit"
```

Congratulations! You have now set up the [Metasploit Web Service (REST API)][msf-web-service] and the backend database.

</details>

<h2 id="optional-tips-to-speed-up-common-workflows">Optional: Tips to speed up common workflows</h2>

<details><summary>The following section is optional but may improve your efficiency.  Click to expand.</summary>

- Making sure you're in the right directory to run `msfconsole` can become tedious, so consider using the following Bash alias:

```bash
echo 'alias msfconsole="pushd $HOME/git/metasploit-framework &amp;&amp; ./msfconsole &amp;&amp; popd"' &gt;&gt; ~/.bash_aliases
```

 - Consider generating a GPG key to sign your commits.  Read about [why][git-horror] and [how][signing-howto].

 - Developers tend to customize their own [git aliases] to speed up common commands, but here are a few common ones:

```rc
[alias]
# An easy, colored oneline log format that shows signed/unsigned status
nicelog = log --pretty=format:'%Cred%h%Creset -%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%aE&gt;%Creset [%G?]'

# Shorthand commands to always sign (-S) and always edit the commit message.
m = merge -S --no-ff --edit
c = commit -S --edit

# Shorthand to always blame (praise) without looking at whitespace changes
b= blame -w
```

 - If you plan on working with other contributor's pull requests, you may run the following script which makes it easier to do so:

```
tools/dev/add_pr_fetch.rb
```

  After running the above script, you can `checkout` other pull requests more easily:

```
git fetch upstream
git checkout fixes-to-pr-12345 upstream/pr/12345
```

 - If you're writing test cases (which you should), then make sure [rspec] works:

```bash
rake spec
```

You should see over 9000 tests run, mostly resulting in green dots, a few in yellow stars, and no red errors.

</details>

<h1 id="great--now-what">Great!  Now what?</h1>

<p>We’re excited to see your upcoming contributions of new modules, documentation, and fixes!  Check out our <a href="https://github.com/rapid7/metasploit-framework/wiki#metasploit-development">wiki documentation</a> and, if you’re looking for inspiration, keep an eye out for <a href="https://github.com/rapid7/metasploit-framework/issues?q=is%3Aopen+label%3Anewbie-friendly">newbie-friendly pull requests and issues</a>.   Please <a href="https://help.github.com/articles/about-pull-requests/">submit your new pull requests</a> and reach out to us on <a href="https://www.metasploit.com/slack">Slack</a> for community help.</p>

<p>Finally, we welcome your feedback on this guide, so feel free to reach out to us on <a href="https://www.metasploit.com/slack">Slack</a> or open a <a href="https://github.com/rapid7/metasploit-framework/issues/new">new issue</a>.  For their significant contributions to this guide, we would like to thank <a href="https://github.com/kernelsmith">@kernelsmith</a>, <a href="https://github.com/corelanc0d3r">@corelanc0d3r</a>, and <a href="https://github.com/ffmike">@ffmike</a>.</p>

:ET